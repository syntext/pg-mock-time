# Example Dockerfile showing how to include pg_mock_time extension
# in your own PostgreSQL Docker image

FROM postgres:17-bookworm AS builder

# Install build dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    postgresql-server-dev-17 \
    git \
    && rm -rf /var/lib/apt/lists/*

# Clone and build the extension from GitHub
RUN git clone https://github.com/syntext/pg-mock-time.git /tmp/pg-mock-time \
    && cd /tmp/pg-mock-time \
    && make -f Makefile \
    && make -f Makefile install-all

# Final stage - your production image
FROM postgres:17-bookworm

# Copy the extension files from builder
COPY --from=builder /usr/share/postgresql/17/extension/pg_mock_time* /usr/share/postgresql/17/extension/
COPY --from=builder /usr/lib/postgresql/17/lib/pg_mock_time* /usr/lib/postgresql/17/lib/

# Optional: Set LD_PRELOAD if you want time mocking available by default
# ENV LD_PRELOAD=/usr/lib/postgresql/17/lib/pg_mock_time_simple.so

# Your other customizations here...
# COPY your_init.sql /docker-entrypoint-initdb.d/
# ENV POSTGRES_DB=mydb
# ENV POSTGRES_USER=myuser
# ENV POSTGRES_PASSWORD=mypassword